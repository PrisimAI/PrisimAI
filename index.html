<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PrisimAI</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<style>
:root {
    --glass-bg: rgba(255, 255, 255, 0.15);
    --glass-border: rgba(255, 255, 255, 0.2);
    --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
}
body {
    font-family: 'Inter', sans-serif;
    background: linear-gradient(135deg, #f0f4ff 0%, #e6f0ff 100%);
}
body.dark {
    background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
}
.glass {
    background: var(--glass-bg);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: 1px solid var(--glass-border);
    box-shadow: var(--glass-shadow);
}
#chat-history::-webkit-scrollbar { width: 8px; }
#chat-history::-webkit-scrollbar-track { background: rgba(0,0,0,0.05); }
#chat-history::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.2); border-radius:4px; }
@keyframes bounce-dot { 0%,100%{transform:translateY(0);}50%{transform:translateY(-8px);} }
.bounce-dot { animation:bounce-dot 1.4s infinite ease-in-out; }
@keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }
.fade-in { animation:fadeIn 0.3s ease-out forwards; }
</style>
</head>
<body class="text-gray-800 antialiased flex h-screen overflow-hidden dark:text-gray-100 transition-colors duration-300">

<!-- Sidebar -->
<aside class="w-64 flex-shrink-0 flex flex-col justify-between p-6 sm:flex shadow-xl rounded-r-3xl glass m-4">
    <div class="space-y-6">
        <!-- Dark mode toggle -->
        <button id="dark-mode-toggle" class="absolute top-4 right-4 p-2 rounded-full bg-white/20 dark:bg-gray-700/20 text-gray-700 dark:text-gray-200 shadow hover:bg-white/30 dark:hover:bg-gray-600/30 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-400">
            <svg id="dark-mode-icon" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path id="sun-icon" class="block dark:hidden" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m8.66-13.66l-.71.71M4.05 19.07l-.71.71M21 12h-1M4 12H3m16.66 5.66l-.71-.71M4.05 4.93l-.71-.71M12 7a5 5 0 100 10 5 5 0 000-10z" />
                <path id="moon-icon" class="hidden dark:block" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12.79A9 9 0 1111.21 3a7 7 0 109.79 9.79z" />
            </svg>
        </button>

        <!-- Header -->
        <div class="flex items-center space-x-3 mb-6">
            <h1 class="text-xl font-bold text-gray-900 dark:text-white">PrisimAI</h1>
        </div>

        <!-- New Chat Button -->
        <button id="new-chat-btn" class="w-full p-2 rounded-xl bg-blue-500/20 text-blue-600 dark:text-blue-300 font-semibold shadow hover:bg-blue-500/30 active:scale-95 transition-all duration-200">
            + New Chat
        </button>

        <!-- Model Selector -->
        <div class="space-y-2 mt-8">
            <label for="model-selector" class="text-sm font-medium text-gray-700 dark:text-gray-300">Select Model</label>
            <select id="model-selector" class="w-full p-2 rounded-xl border border-gray-300/30 dark:border-gray-600/30 bg-white/20 dark:bg-gray-800/30 text-gray-800 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 shadow hover:border-blue-400 transition-all duration-200">
                <option value="" disabled selected>Loading models...</option>
            </select>
        </div>
    </div>

    <!-- Profile & Auth Section -->
    <div class="mt-8">
        <div class="flex items-center space-x-3 p-3 hover:bg-blue-500/10 rounded-xl transition-all duration-200 cursor-pointer active:scale-95">
            <img src="https://placehold.co/40x40" alt="Profile" class="w-10 h-10 rounded-full border-2 border-blue-400/30 shadow">
            <div>
                <div class="font-semibold text-gray-900 dark:text-white">Random Stranger</div>
                <div class="text-sm text-gray-500 dark:text-gray-400">Free User</div>
            </div>
        </div>
        <div id="auth-section" class="mt-6">
            <input id="email" type="email" placeholder="Email" class="w-full p-2 mb-2 rounded-lg" />
            <input id="password" type="password" placeholder="Password" class="w-full p-2 mb-2 rounded-lg" />
            <button id="login-btn" class="w-full p-2 bg-blue-500 text-white rounded-lg">Login / Signup</button>
            <button id="logout-btn" class="hidden w-full p-2 bg-red-500 text-white rounded-lg mt-2">Logout</button>
        </div>
    </div>
</aside>

<!-- Main Content -->
<main class="flex-1 flex flex-col relative p-4">
    <div class="flex-1 flex flex-col justify-between items-center">
        <div id="chat-container" class="flex-1 relative w-full max-w-2xl mx-auto my-8 rounded-3xl glass overflow-hidden">
            <div id="welcome-message" class="absolute inset-0 flex flex-col justify-center items-center text-center p-8 space-y-4 text-gray-500 dark:text-gray-400">
                <h2 class="text-2xl font-bold text-gray-800 dark:text-white">Hello there, Stranger!</h2>
                <p class="text-lg">Try typing something in the box below.</p>
            </div>
            <div id="chat-history" class="absolute inset-0 overflow-y-auto p-8 space-y-4 hidden"></div>
            <div class="absolute bottom-0 inset-x-0 p-4 bg-white/30 dark:bg-gray-800/30 glass border-t border-gray-200/30 dark:border-gray-700/30">
                <form id="chat-form" class="flex items-end space-x-4">
                    <textarea id="chat-input" placeholder="Message PrisimAI âœ¨..." rows="1" class="flex-1 p-3 rounded-2xl border border-gray-300/30 dark:border-gray-600/30 bg-white/30 dark:bg-gray-700/30 text-gray-800 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none shadow"></textarea>
                    <button type="submit" class="p-3 rounded-2xl bg-blue-500 text-white shadow-lg hover:bg-blue-600 active:bg-blue-700 active:scale-95 transition-all duration-200">
                        Send
                    </button>
                </form>
            </div>
        </div>
    </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
// Supabase setup
const SUPABASE_URL = "https://pzbuyeysrqckwuindxoh.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB6YnV5ZXlzcnFja3d1aW5keG9oIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3NTQ5NTIsImV4cCI6MjA3NTMzMDk1Mn0.pSrv0khZQOlW0Gp3tf3k9fCl71BjwKc--Cuo2FdFbeY";
const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
</script>

<script>
// Auth
const loginBtn = document.getElementById("login-btn");
const logoutBtn = document.getElementById("logout-btn");

loginBtn.addEventListener("click", async () => {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    if(!email || !password){ alert("Email & password required"); return; }

    const { data, error } = await supabase.auth.signInWithPassword({ email, password });
    if (error?.message.includes("Invalid login credentials")) {
        const { error: signUpError } = await supabase.auth.signUp({ email, password });
        if(signUpError) alert(signUpError.message);
        else alert("Account created! You can now log in.");
    } else if(error) alert(error.message);
    else { alert("Logged in!"); loadUserProfile(); }
});

logoutBtn.addEventListener("click", async () => {
    await supabase.auth.signOut();
    alert("Logged out!");
    location.reload();
});

// Load user profile & chat
async function loadUserProfile() {
    const { data: { user } } = await supabase.auth.getUser();
    if(user) {
        document.querySelector("#auth-section").classList.add("hidden");
        logoutBtn.classList.remove("hidden");
        document.querySelector(".font-semibold").textContent = user.email.split("@")[0];
        await loadChatHistoryFromDB(user.id);
    }
}

// Chat history
const chatHistory = document.getElementById("chat-history");
let chatMessages = [];

async function saveChatHistory() {
    const { data: { user } } = await supabase.auth.getUser();
    if(!user) return;
    await supabase.from("chats").insert({ user_id: user.id, message: chatMessages });
}

async function loadChatHistoryFromDB(userId) {
    const { data, error } = await supabase.from("chats").select("message").eq("user_id", userId).order("created_at",{ascending:false}).limit(1);
    if(data?.length>0){
        chatMessages = data[0].message;
        chatMessages.forEach(msg => addMessage(msg.content, msg.role));
    }
}

// Dark mode
const darkModeToggle = document.getElementById('dark-mode-toggle');
darkModeToggle.addEventListener('click', ()=>{
    document.documentElement.classList.toggle('dark');
    localStorage.setItem('theme', document.documentElement.classList.contains('dark')?'dark':'light');
});
if(localStorage.getItem('theme')==='dark'||(!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)){
    document.documentElement.classList.add('dark');
}

// Chat functions
const chatInput = document.getElementById('chat-input');
const chatForm = document.getElementById('chat-form');
const welcomeMessage = document.getElementById('welcome-message');
const newChatBtn = document.getElementById('new-chat-btn');
const modelSelector = document.getElementById('model-selector');
const apiKey = 'ScdTyGr9t5KJxW_c';
const referrer = 'https://prisimai.github.io/PrisimAI';
const textApiUrl = 'https://text.pollinations.ai/openai';
const imageApiUrl = 'https://image.pollinations.ai/prompt/';

function addMessage(message, role, type='text') {
    welcomeMessage.classList.add('hidden');
    chatHistory.classList.remove('hidden');
    const isUser = role==='user';
    const wrapper = document.createElement('div');
    wrapper.classList.add('flex','space-x-4','mb-4','fade-in', isUser?'justify-end':'justify-start');
    wrapper.innerHTML = type==='image'? `<img src="${message}" class="rounded-xl w-full max-w-sm shadow-lg">`:
    `<div class="p-4 rounded-xl shadow-md ${isUser?'bg-blue-500 text-white':'bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-100'}" style="white-space:pre-wrap; max-width:80%;"><p>${message}</p></div>`;
    chatHistory.appendChild(wrapper);
    chatMessages.push({role, content:message});
    chatHistory.scrollTop = chatHistory.scrollHeight;
}

// Chat form submit
chatForm.addEventListener('submit', e=>{
    e.preventDefault();
    const msg = chatInput.value.trim();
    if(!msg) return;
    addMessage(msg,'user');
    chatInput.value=''; chatInput.style.height='auto';
    handleChat(msg);
});

// New chat button
newChatBtn.addEventListener('click', ()=>{
    chatHistory.innerHTML=''; chatMessages=[]; welcomeMessage.classList.remove('hidden'); chatHistory.classList.add('hidden');
});

// Fetch models
async function fetchModels(){
    const models = [
        {name:"gemini",description:"Gemini 2.5 Flash Lite (api.navy)"},
        {name:"openai",description:"OpenAI GPT-5 Nano"},
        {name:"openai-fast",description:"OpenAI GPT-4.1 Nano"},
        {name:"openai-large",description:"OpenAI GPT-4.1"},
        {name:"midijourney",description:"MIDIjourney"},
        {name:"qwen-coder",description:"Qwen 2.5 Coder 32B"},
        {name:"bidara",description:"BIDARA (NASA)"}
    ];
    modelSelector.innerHTML='';
    models.forEach(m=>{ const o=document.createElement('option'); o.value=m.name; o.textContent=m.description; modelSelector.appendChild(o); });
    modelSelector.value='openai';
}

// Initialize
document.addEventListener('DOMContentLoaded', ()=>{
    loadUserProfile();
    fetchModels();
});
</script>
</body>
</html>
