name: AI Issue Responder

on:
  issues:
    types: [opened]

jobs:
  auto-ai-response:
    runs-on: ubuntu-latest
    steps:
      # Step 1: Generate AI response using Pollinations
      - name: Generate AI response
        id: ai
        run: |
          # Safely escape issue title and body into JSON strings
          ISSUE_TITLE=$(echo "${{ github.event.issue.title }}" | jq -R .)
          ISSUE_BODY=$(echo "${{ github.event.issue.body }}" | jq -R .)

          # Build valid JSON payload for Pollinations AI
          PAYLOAD=$(jq -n --arg title "$ISSUE_TITLE" --arg body "$ISSUE_BODY" \
            '{"model":"openai","prompt":"You are a helpful GitHub assistant. Someone opened an issue titled \($title) with the description: \($body). Suggest possible causes and fixes in a friendly tone."}')

          # Call the Pollinations AI API
          RESPONSE=$(curl -s "https://text.pollinations.ai/" \
            -H "Content-Type: application/json" \
            -d "$PAYLOAD")

          # Save the AI response for next step
          echo "response<<EOF" >> $GITHUB_OUTPUT
          echo "$RESPONSE" >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT

      # Step 2: Comment on the issue with AI response
      - name: Comment on issue
        uses: peter-evans/create-or-update-comment@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          issue-number: ${{ github.event.issue.number }}
          body: |
            ðŸ¤– **AI Assistant Response:**
            ${{ steps.ai.outputs.response }}

            _Generated automatically by Pollinations AI ðŸŒ¸_
